<!DOCTYPE html>
<head>
    <title>Lima Kilo</title>
    <link rel="stylesheet" href="common.css">
    <link rel="icon" type="image/png" sizes="16x16" href="miggus_16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="miggus_32x32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="miggus_48x48.png">
</head>
<body class="flex">
    <nav>
        <h1>Servers</h1>
        <h2>Flashpoint Levant (Europe)</h2>
        <div class="item">
            <a id="levant-eu-details" href="servers/levant_eu.html" target="main">Server Details</a>
            <button type="button">X</button>
        </div>
        <div class="item">
            <a id="levant-eu-sneaker" href="https://sneaker.eu.limakilo.net/servers/levant" target="main">Sneaker GCI</a>
            <button type="button">X</button>
        </div>
        <div class="item">
            <a id="levant-eu-status" href="https://levant.eu.limakilo.net/status" target="main">Campaign Status</a>
            <button type="button">X</button>
        </div>
        <h2>Flashpoint Levant (North America)</h2>
        <div class="item">
            <a id="levant-na-details" href="servers/levant_na.html" target="main">Server Details</a>
            <button type="button">X</button>
        </div>
        <div class="item">
            <a id="levant-na-sneaker" href="https://sneaker.na.limakilo.net/servers/levant" target="main">Sneaker GCI</a>
            <button type="button">X</button>
        </div>
        <div class="item">
            <a id="levant-na-status" href="https://levant.na.limakilo.net/status" target="main">Campaign Status</a>
            <button type="button">X</button>
        </div>
        <div class="spacer"></div>
        <a href="https://discord.gg/dPG9pNuxJc" target="_blank">Join our Discord</a>
        <a href="https://www.patreon.com/LimaKilo" target="_blank">Support us on Patreon</a>
        <a href="https://github.com/team-limakilo" target="_blank">Open-source code</a>
    </nav>
    <iframe name="main" class="content"></iframe>
    <iframe name="loading" class="content hidden" src="loading.html"></iframe>
    <script>
        const main = document.querySelector("iframe[name=main]");
        const loading = document.querySelector("iframe[name=loading]");
        const items = document.querySelectorAll("nav .item");

        // Enable dynamic links
        items.forEach((item) => {
            const link = item.querySelector("a");
            const closeButton = item.querySelector("button");
            link.setAttribute("target", link.id);
            link.addEventListener("click", (event) => {
                /** @type {HTMLElement} */
                const link = event.target;
                const item = link.parentElement;
                location.hash = link.id;
                items.forEach((other) => {
                    other.classList.remove("active");
                });
                item.classList.add("active");
                document.querySelectorAll("iframe.content").forEach((iframe) => {
                    iframe.classList.add("hidden");
                });
                /** @type {HTMLElement} */
                let iframe = document.querySelector(`iframe[name="${link.id}"`);
                if (iframe == null) {
                    // Create a new iframe
                    loading.classList.remove("hidden");
                    iframe = document.createElement("iframe");
                    iframe.setAttribute("name", link.id);
                    iframe.setAttribute("src", link.href);
                    iframe.classList.add("content");
                    iframe.classList.add("hidden");
                    document.querySelector("iframe.content").insertAdjacentElement("afterend", iframe);
                    iframe.addEventListener("load", (event) => {
                        const activeLink = document.querySelector(".item.active a");
                        if (iframe.name === activeLink.id) {
                            loading.classList.add("hidden");
                            iframe.classList.remove("hidden");
                        }
                    });
                    item.classList.add("open");
                } else {
                    // Switch to existing iframe
                    loading.classList.add("hidden");
                    iframe.classList.remove("hidden");
                    event.preventDefault();
                }
            });
            // Close iframe when the button is clicked
            closeButton.addEventListener("click", (event) => {
                /** @type {HTMLElement} */
                const button = event.target;
                const item = button.parentElement;
                const link = item.querySelector("a");
                item.classList.remove("open");
                item.classList.remove("active");
                document.querySelector(`iframe[name="${link.id}"]`).remove();
                if (`#${link.id}` === location.hash) {
                    loading.classList.add("hidden");
                    location.hash = "";
                }
            });
        });

        // Activate link on page load
        if (location.hash) {
            const link = document.querySelector(location.hash);
            if (link != null) {
                link.dispatchEvent(new Event("click"));
            }
        }

        // And on changes as well
        window.addEventListener("hashchange", (event) => {
            const activeLink = document.querySelector(".item.active a");
            if (activeLink == null || `#${activeLink.id}` !== location.hash) {
                const newLink = document.querySelector(location.hash);
                if (newLink != null) {
                    newLink.dispatchEvent(new Event("click"));
                }
            }
        });

        // Remove main iframe if JS is available
        main.remove();
    </script>
</body>
